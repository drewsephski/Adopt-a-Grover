generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Campaign {
  id               String           @id @default(cuid())
  name             String
  status           CampaignStatus   @default(DRAFT)
  organizationType OrganizationType @default(NONPROFIT)
  startsAt         DateTime?
  endsAt           DateTime?
  dropOffDeadline  DateTime?
  dropOffAddress   String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  families         Family[]
}

model Family {
  id         String   @id @default(cuid())
  alias      String
  campaignId String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  campaign   Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  gifts      Gift[]
  persons    Person[]

  @@index([campaignId])
}

model Person {
  id        String   @id @default(cuid())
  firstName String
  familyId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  age       Int?
  role      String?
  gifts     Gift[]
  family    Family   @relation(fields: [familyId], references: [id], onDelete: Cascade)

  @@index([familyId])
}

model Gift {
  id          String   @id @default(cuid())
  name        String
  description String?
  productUrl  String?
  quantity    Int
  familyId    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  personId    String?
  claims      Claim[]
  family      Family   @relation(fields: [familyId], references: [id], onDelete: Cascade)
  person      Person?  @relation(fields: [personId], references: [id])

  @@index([familyId])
  @@index([personId])
}

model Claim {
  id         String   @id @default(cuid())
  giftId     String
  donorName  String
  donorEmail String
  quantity   Int      @default(1)
  createdAt  DateTime @default(now())
  gift       Gift     @relation(fields: [giftId], references: [id], onDelete: Cascade)

  @@index([giftId])
}

model Settings {
  id                     String   @id @default(cuid())
  emailNotifications     Boolean  @default(true)
  autoArchiveCampaigns   Boolean  @default(true)
  automaticBackups       Boolean  @default(true)
  twoFactorAuth          Boolean  @default(false)
  allowAdminRegistration Boolean  @default(false)
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
}

model EmailTemplate {
  id          String            @id @default(cuid())
  type        EmailTemplateType @unique
  name        String
  subject     String
  htmlContent String?
  textContent String?
  isActive    Boolean           @default(true)
  description String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
}

enum CampaignStatus {
  DRAFT
  ACTIVE
  CLOSED
  ARCHIVED
}

enum OrganizationType {
  SCHOOL
  CHURCH
  NONPROFIT
  BUSINESS
}

enum EmailTemplateType {
  CLAIM_CONFIRMATION
  DONOR_REMINDER
  WELCOME_EMAIL
  CAMPAIGN_UPDATE
  CAMPAIGN_COMPLETION
  ADMIN_NOTIFICATION
}
